// ;(function () {

// 	'use strict';

// 	var isMobile = {
// 		Android: function() {
// 			return navigator.userAgent.match(/Android/i);
// 		},
// 			BlackBerry: function() {
// 			return navigator.userAgent.match(/BlackBerry/i);
// 		},
// 			iOS: function() {
// 			return navigator.userAgent.match(/iPhone|iPad|iPod/i);
// 		},
// 			Opera: function() {
// 			return navigator.userAgent.match(/Opera Mini/i);
// 		},
// 			Windows: function() {
// 			return navigator.userAgent.match(/IEMobile/i);
// 		},
// 			any: function() {
// 			return (isMobile.Android() || isMobile.BlackBerry() || isMobile.iOS() || isMobile.Opera() || isMobile.Windows());
// 		}
// 	};

// 	var mobileMenuOutsideClick = function() {

// 		$(document).click(function (e) {
// 	    var container = $("#colorlib-offcanvas, .js-colorlib-nav-toggle");
// 	    if (!container.is(e.target) && container.has(e.target).length === 0) {

// 	    	if ( $('body').hasClass('offcanvas') ) {

//     			$('body').removeClass('offcanvas');
//     			$('.js-colorlib-nav-toggle').removeClass('active');
				
// 	    	}
	    
	    	
// 	    }
// 		});

// 	};


// 	var offcanvasMenu = function() {

// 		$('#page').prepend('<div id="colorlib-offcanvas" />');
// 		$('#page').prepend('<a href="#" class="js-colorlib-nav-toggle colorlib-nav-toggle colorlib-nav-white"><i></i></a>');
// 		var clone1 = $('.menu-1 > ul').clone();
// 		$('#colorlib-offcanvas').append(clone1);
// 		var clone2 = $('.menu-2 > ul').clone();
// 		$('#colorlib-offcanvas').append(clone2);

// 		$('#colorlib-offcanvas .has-dropdown').addClass('offcanvas-has-dropdown');
// 		$('#colorlib-offcanvas')
// 			.find('li')
// 			.removeClass('has-dropdown');

// 		// Hover dropdown menu on mobile
// 		$('.offcanvas-has-dropdown').mouseenter(function(){
// 			var $this = $(this);

// 			$this
// 				.addClass('active')
// 				.find('ul')
// 				.slideDown(500, 'easeOutExpo');				
// 		}).mouseleave(function(){

// 			var $this = $(this);
// 			$this
// 				.removeClass('active')
// 				.find('ul')
// 				.slideUp(500, 'easeOutExpo');				
// 		});


// 		$(window).resize(function(){

// 			if ( $('body').hasClass('offcanvas') ) {

//     			$('body').removeClass('offcanvas');
//     			$('.js-colorlib-nav-toggle').removeClass('active');
				
// 	    	}
// 		});
// 	};


// 	var burgerMenu = function() {

// 		$('body').on('click', '.js-colorlib-nav-toggle', function(event){
// 			var $this = $(this);


// 			if ( $('body').hasClass('overflow offcanvas') ) {
// 				$('body').removeClass('overflow offcanvas');
// 			} else {
// 				$('body').addClass('overflow offcanvas');
// 			}
// 			$this.toggleClass('active');
// 			event.preventDefault();

// 		});
// 	};
	

// 	var contentWayPoint = function() {
// 		var i = 0;
// 		$('.animate-box').waypoint( function( direction ) {

// 			if( direction === 'down' && !$(this.element).hasClass('animated-fast') ) {
				
// 				i++;

// 				$(this.element).addClass('item-animate');
// 				setTimeout(function(){

// 					$('body .animate-box.item-animate').each(function(k){
// 						var el = $(this);
// 						setTimeout( function () {
// 							var effect = el.data('animate-effect');
// 							if ( effect === 'fadeIn') {
// 								el.addClass('fadeIn animated-fast');
// 							} else if ( effect === 'fadeInLeft') {
// 								el.addClass('fadeInLeft animated-fast');
// 							} else if ( effect === 'fadeInRight') {
// 								el.addClass('fadeInRight animated-fast');
// 							} else {
// 								el.addClass('fadeInUp animated-fast');
// 							}

// 							el.removeClass('item-animate');
// 						},  k * 200, 'easeInOutExpo' );
// 					});
					
// 				}, 100);
				
// 			}

// 		} , { offset: '85%' } );
// 	};


// 	var dropdown = function() {

// 		$('.has-dropdown').mouseenter(function(){

// 			var $this = $(this);
// 			$this
// 				.find('.dropdown')
// 				.css('display', 'block')
// 				.addClass('animated-fast fadeInUpMenu');

// 		}).mouseleave(function(){
// 			var $this = $(this);

// 			$this
// 				.find('.dropdown')
// 				.css('display', 'none')
// 				.removeClass('animated-fast fadeInUpMenu');
// 		});

// 	};


// 	var goToTop = function() {

// 		$('.js-gotop').on('click', function(event){
			
// 			event.preventDefault();

// 			$('html, body').animate({
// 				scrollTop: $('html').offset().top
// 			}, 500, 'easeInOutExpo');
			
// 			return false;
// 		});

// 		$(window).scroll(function(){

// 			var $win = $(window);
// 			if ($win.scrollTop() > 200) {
// 				$('.js-top').addClass('active');
// 			} else {
// 				$('.js-top').removeClass('active');
// 			}

// 		});
	
// 	};

// 	// var increment = function(){

// 	// };


// 	// Loading page
// 	var loaderPage = function() {
// 		$(".colorlib-loader").fadeOut("slow");
// 	};


// 	var sliderMain = function() {
		
// 	  	$('#colorlib-hero .flexslider').flexslider({
// 			animation: "fade",
// 			slideshowSpeed: 5000,
// 			directionNav: true,
// 			start: function(){
// 				setTimeout(function(){
// 					$('.slider-text').removeClass('animated fadeInUp');
// 					$('.flex-active-slide').find('.slider-text').addClass('animated fadeInUp');
// 				}, 500);
// 			},
// 			before: function(){
// 				setTimeout(function(){
// 					$('.slider-text').removeClass('animated fadeInUp');
// 					$('.flex-active-slide').find('.slider-text').addClass('animated fadeInUp');
// 				}, 500);
// 			}

// 	  	});

// 	};

// 	// Owl Carousel
// 	var owlCrouselFeatureSlide = function() {
// 		var owl = $('.owl-carousel');
// 		owl.owlCarousel({
// 		   animateOut: 'fadeOut',
// 		   animateIn: 'fadeIn',
// 		   autoplay: false,
// 		   autoplayHoverPause: true,
// 		   loop:false,
// 		   margin:0,
// 		   nav:false,
// 		   dots: true,
// 		   autoHeight: false,
// 		   items: 1,
// 		   navText: [
// 		      "<i class='icon-chevron-left owl-direction'></i>",
// 		      "<i class='icon-chevron-right owl-direction'></i>"
// 	     	]
// 		});

// 		var owl2 = $('.owl-carousel2');
// 		owl2.owlCarousel({
// 			animateOut: 'fadeOut',
// 		   animateIn: 'fadeIn',
// 		   autoplay: true,
// 		   autoplayHoverPause: true,
// 		   loop:true,
// 		   margin:0,
// 		   nav:false,
// 		   dots: false,
// 		   autoHeight: true,
// 		   items: 1,
// 		   navText: [
// 		      "<i class='icon-chevron-left owl-direction'></i>",
// 		      "<i class='icon-chevron-right owl-direction'></i>"
// 	     	]
// 		});
// 	};

// 	var parallax = function() {

// 		if ( !isMobile.any() ) {
// 			$(window).stellar({
// 				horizontalScrolling: false,
// 				hideDistantElements: false, 
// 				responsive: true

// 			});
// 		}
// 	};

// 	var datePicker = function() {
// 		// jQuery('#time').timepicker();
// 		jQuery('.date').datepicker({
// 		  'format': 'm/d/yyyy',
// 		  'autoclose': true
// 		});
// 	};
	
// 	$(function(){
// 		mobileMenuOutsideClick();
// 		offcanvasMenu();
// 		burgerMenu();
// 		contentWayPoint();
// 		sliderMain();
// 		dropdown();
// 		goToTop();
// 		loaderPage();
// 		owlCrouselFeatureSlide();
// 		parallax();
// 		datePicker();
// 	});
// }());
$(function () {

    $.ajaxSetup({
        headers: {
            'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
        }
    });

    // $('[data-toggle="tooltip"]').tooltip();
})

$('.list-group-item').on('click', function() {
    let isOpen = $(this).hasClass("open");
    if (isOpen) {
        $(this).removeClass("open");
    } else {
        $('.sidebar-category .list-group-item.open').removeClass('open');
        $(this).addClass("open");
    }
});

// // product pagination
// function fetchProducts(page){

//     var category_id = $('input[name="category_id"]').val();
//     var search = $('input[name="search"]').val();
//     var min_price = $('.price-input .input-min').val();
//     var max_price = $('.price-input .input-max').val();
//     var brands = [];
//     $('.filter-brand').each(function () {
//         if (this.checked) {
//             brands.push($(this).val());
//         }
//     });

//     $.ajax({
//         url: routes.fetchProducts,
//         data: {
//             page: page,
//             category_id: category_id,
//             keyword: search,
//             min_price: min_price,
//             max_price: max_price,
//             brands: brands,
//         },
//         beforeSend: function() {
//             window.scrollTo({ top: 0, behavior: 'smooth' });
//             $('#product-list').empty();
//             $(".colorlib-loader").css("display", "block");
//             $(".colorlib-loader").fadeOut("slow");
//         },
//         success:function(data) {
//             $('#product-list').html(data);
//         },
//         complete: function() {
//         },
//     });
// }

// $(document).on('click', '#product-list .pagination a', function(event){
//     event.preventDefault(); 
//     var page = $(this).attr('href').split('page=')[1];
//     fetchProducts(page);
// });

// // filter
// $('.applyFilter').click(function(){ 
//     fetchProducts(1);
// });

// $('.filter-brand').change(function() {
//     fetchProducts(1);
// });

// // search product
// $('.search').autoComplete({
//     resolver: 'custom',
//     events: {
//         search: function (qry, callback) {
//             $.ajax( routes.searchProducts, {
//                 data: {qry: qry}
//             }).done(function (res) {
//                 callback(res.data)
//             });
//         }
//     },
//     formatResult: function (item){
//         return {
//             id: item.id,
//             value: item.name,
//             text: item.name,
//             html: `<div class="row"><div class="col-2 align-self-center"><img src="${item.product_avatar_link}" width="50" height="50" class="rounded p-avatar" /></div><div class="col-2"><p class="p-name mb-0">${item.name}</p><p class="p-price mb-0">${numberWithCommas(item.price)} đ</p></div></div>`
//         };
//     },
//     noResultsText: 'Không tìm thấy kết quả nào'
// });

// $('.search').on('autocomplete.select', function(evt, item) {
//     $('input.search').val(item.name);
//     $('input.search').closest('form').submit();
// });

// // product details
// $('.product-detail-wrap .quantity-left-minus').click(function(){
//     let input = $('.product-detail-wrap #quantity');
//     let quantity = parseInt(input.val() || 0);
//     if (quantity >= 1) {
//         input.val(quantity - 1);
//     }
// });

// $('.product-detail-wrap .quantity-right-plus').click(function(){
//     let input = $('.product-detail-wrap #quantity');
//     let quantity = parseInt(input.val() || 0);
//     input.val(quantity + 1);
// });

$('.product-item .buy-now').click(function() {
    var quantity = 1;
    var productId = $(this).closest('.product-item').attr('data-id');
    addCart(productId, quantity);
});

// $('.copyLink').click(function() {
//     var url = $(this).attr('data-url');
// 	var temp = $("<input>");
//     $("body").append(temp);
//     temp.val(url).select();
//     document.execCommand("copy");
//     temp.remove();
//     $('.copyMgs').text('Đã sao chép liên kết sản phẩm.')
// });

// $('#submitReview').click(function(){
//     let productId = $('input[name="product_id"]').val();
//     let rating = $('input[name="rating"]:checked').val();
//     let comment = $('textarea[name="comment"]').val();
//     $.ajax({
//         type: "POST",
//         url: routes.reviewAdd,
//         data: {
//             productId: productId,
//             rating: rating,
//             comment: comment,
//         },
//         beforeSend: function() {
//             $('#submitReview').prop("disabled", true);
//         },
//         success: function(res){
//             if(res && res.success) {
//                 loadReviews(productId);
//             }
//         },
//         complete: function() {
//             $('#submitReview').prop("disabled", false);
//         },
//     });
// });

// function loadReviews(productId) {
//     $.ajax({
//         type: "POST",
//         url: routes.reviewLoad,
//         data: {
//             productId: productId,
//         },
//         beforeSend: function() {
//         },
//         success: function(res){
//             if(res && res.success) {

//                 $('.reviews-list').empty();

//                 for(let review of res.data.data) {
//                     let reviewHTML = $('.review-item .review').clone();
//                     let avatar = review.user.avatar ? review.user.avatar : '/website/images/person3.jpg'
//                     reviewHTML.find('.user-img').css('background-image', 'url(' + avatar + ')');
//                     reviewHTML.find('.user-name').text(review.user.name);
//                     reviewHTML.find('.created-at').text(review.review_at);
//                     reviewHTML.find('.comment').text(review.comment);
//                     for(i = 1 ; i <= review.rating; i ++) {
//                         reviewHTML.find('.star i:nth-child('+i+')').removeClass('icon-star-empty');
//                         reviewHTML.find('.star i:nth-child('+i+')').addClass('icon-star-full');
//                     }
//                     $('.reviews-list').append(reviewHTML);
//                 }
//             }
//         },
//         complete: function() {
//         },
//     });
// }

// // cart
$('.product-cart .quantity-left-minus').click(function(){
    let parent = $(this).closest('.product-cart');
    let input = parent.find('.quantity');
    let quantity = parseInt(input.val() || 0);
    if (quantity >= 1) {
        input.val(quantity - 1);
        updateCart(parent, 'update');
    }
});

$('.product-cart .quantity-right-plus').click(function(){
    let parent = $(this).closest('.product-cart');
    let input = parent.find('.quantity');
    let quantity = parseInt(input.val() || 0);
    input.val(quantity + 1);
    updateCart(parent, 'update');
});

// $('.product-cart .quantity').on('change keyup', function(){
//     let parent = $(this).closest('.product-cart');
//     updateCart(parent, 'update');
// });

// $('.product-cart .remove-cart').click(function() {
//     if (confirm('Bạn có chắc muốn xóa sản phẩm này khỏi giỏ hàng!')) {
//         let parent = $(this).closest('.product-cart');
//         parent.find('.quantity').val(0);
//         updateCart(parent, 'remove');
//     }
// })

// $('#applyCoupon').click(function() {
//     var code = $('input[name="code"]').val();
//     applyCoupon(code)
// });

// // functions
// $.ajaxSetup({
//     headers: {
//         'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
//     }
// });

function addCart(productId, quantity) {
    $.ajax({
        type: "POST",
        url: routes.cartAdd,
        data: {
            product_id: productId, 
            quantity: quantity,
        },
        beforeSend: function() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        },
        success: function(res){
            if(res && res.status == 'success') {
                $('.cart-count').text(res.data);
            }
        },
        complete: function() {
            displayCartCount();
        },
    });
}

function updateCart(__parent, __method) {
    var url = __method == 'update' ? routes.cartUpdate : routes.cartRemove;
    var rowId = __parent.attr('data-id');
    var quantity = __parent.find('.quantity').val();
    $.ajax({
        type: "POST",
        url: url,
        data: {rowId: rowId, quantity: quantity},
        beforeSend: function() {
    
        },
        success: function(res){
            if(res && res.status == 'success') {

                var carts = Object.entries(res.data);
                var total = 0;
                var totalQty = 0;

                for(let cart of carts) {
                    total = total + parseInt(cart[1].subtotal);
                    totalQty = totalQty + parseInt(cart[1].qty);
                }

                $('.total-payment').text(numberWithCommas(total));

                $('.cart-count').text(totalQty);

                if (quantity == 0) {
                    __parent.remove();
                }

            }
        },
        complete: function() {
            if ( $('.product-cart').length <= 0 ) {
                var emptyCartHtml = '<div class="cart-empty"><p class="text-center mt-2">Không có sản phẩm nào trong giỏ hàng, tiếp tục <a href="/">mua sắm</a></p></div>';
                $('.cart-checkout').addClass('d-none');
                $('.cart-products').append(emptyCartHtml);
            }

            displayCartCount();
        },
    });
}

function displayCartCount() {
    let countCart = parseInt($('.cart-count').text()) || 0;
    if (countCart > 0) {
        $('.cart-count').removeClass('d-none');
    } else {
        $('.cart-count').addClass('d-none');
    }
}

// function applyCoupon(code) {
//     $.ajax({
//         type: "POST",
//         url: routes.couponApply,
//         data: {code: code},
//         beforeSend: function() {
//             $(".colorlib-loader").css("display", "block");
//             $(".colorlib-loader").fadeOut("slow");
//         },
//         success: function(res){
//             if(res && res.status == 'success') {
//                 $('.cart-summary .total .total').text(numberWithCommas(res.data.total) + ' đ');
//                 $('.cart-summary .total .discount').text(numberWithCommas(res.data.discountMoney) + ' đ');
//                 $('.cart-summary .total .total-payment').text(numberWithCommas(res.data.final) + ' đ');
//             }
//             $('.code-message').text(res.message)
//         },
//         complete: function() {
//         },
//     });
// }

// $(".input-price").keypress(function (e) {
//     if (e.which != 8 && e.which != 0 && (e.which < 48 || e.which > 57)) {
//         return false;
//     }
// });

// $('.input-price').on('change keyup', function() {
//     var val = $(this).val().replace(/\D/g,'');
//     $(this).val(numberWithCommas(val));
// })

function numberWithCommas(x) {
	return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
}
